!function(e){e.fn.tree=function(t,a={},c){let i=this,n=this,r={checkboxes:!1,icons:!0,dragdrop:!0};function d(e){if(i.tree_data&&i.tree_data.length>0)for(let t of i.tree_data)if(t.k===e)return t;return null}function s(){function e(t){let a="";for(let c of i.tree_data){if(c.p!==t)continue;let i=e(c.k);a+='<div class="tree-w"><i class="icon'+(""===i?"":" nav-arrow")+'"></i>'+(r.checkboxes?'<i class="icon check"  data-checked="u"></i>':"")+(r.icons?' <i class="fa fa-'+(""!==i?"bank":"home")+'"></i> ':"")+'<div class="t" draggable="true" data-id="'+c.k+'" title="'+c.n+'">'+c.d+"</div>",""!==i&&(a+='<div class="children collapse"><i class="spacer"></i>'+i+"</div>"),a+="</div>"}return a}let t="";for(let a of i.tree_data){if(a.p)continue;let c=e(a.k);t+='<div class="tree-w"><i class="icon'+(""===c?"":" nav-arrow")+' open"></i>'+(r.checkboxes?'<i class="icon check"  data-checked="u"></i>':"")+(r.icons?' <i class="fa fa-globe"></i> ':"")+'<div class="t" data-id="'+a.k+'" title="'+a.n+'">'+a.d+"</div>",""!==c&&(t+='<div class="children"><i class="spacer"></i>'+c+"</div>"),t+="</div>"}return t}function o(t){t.parentsUntil(n,".tree-w").each((function(){const t=e(this),a=t.find(".check").length-1;if(0===a)return;const c=t.children(".check").attr("data-checked"),i=t.find('.check[data-checked="c"]').length-1*("c"===c),n=t.find('.check[data-checked="u"]').length-1*("u"===c);t.children(".check").attr("data-checked",i===a?"c":n===a?"u":"m")}))}function l(e){return e.sort(((t,a)=>{function c(t){for(let a of e)if(a.p===t)return 1;return 0}let i=c(t.k),n=c(a.k);return i!==n?n-i:t.d.localeCompare(a.d)})),e}if(t&&"create"===t.toLowerCase())return this.tree_data=[],void 0!==a.icons&&(r.icons=!!a.icons),void 0!==a.dragdrop&&(r.dragdrop=!!a.dragdrop),void 0!==a.checkboxes&&(r.checkboxes=!!a.checkboxes),void 0!==c&&(i.onAction=c),void 0!==a.data&&(i.tree_data=l(a.data.slice()),i.html(s())),function(){let t=null;n.on("click","i, .t",(t=>{let a=e(t.target);if(a.hasClass("nav-arrow"))a.hasClass("open")?a.removeClass("open").siblings(".children").addClass("collapse"):a.addClass("open").siblings(".children").removeClass("collapse");else if(r.checkboxes&&(a.hasClass("t")||"I"===a.prop("nodeName"))){const t=a.parent().children(".check"),c="c"===t.attr("data-checked")?"u":"c";t.attr("data-checked",c),t.siblings(".children").find(".check").each((function(){e(this).attr("data-checked",c)})),o(a)}else n.find("I,.t").removeClass("text-primary"),a.parent().children(".t, I").addClass("text-primary"),i.onAction&&i.onAction("click",d(a.parent().children(".t").data("id")))})),r.dragdrop&&n.on("dragstart",".t",(a=>{e(a.target).addClass("dragging"),t=e(a.target).data("id")})).on("dragend",".t",(t=>{e(t.target).removeClass("dragging")})).on("dragover",".t",(e=>{e.preventDefault()})).on("dragenter",".t",(t=>{e(t.target).addClass("drag-over")})).on("dragleave",".t",(t=>{e(t.target).removeClass("drag-over")})).on("drop",".t",(a=>{e(a.target).removeClass("drag-over"),e(a.target).hasClass("t")&&i.onAction&&i.onAction("move",d(t),d(e(a.target).data("id"))),a.preventDefault()}))}(),this;if(t&&"set-active-node"===t.toLowerCase()){if(void 0===a)return;return n.each((()=>{!function(t){e(".t").removeClass("text-primary");let c=n.find('.t[data-id="'+t+'"]');c.parent().children(".t,I").addClass("text-primary").parents().removeClass("collapse"),c.length>0&&i.onAction&&i.onAction("click",d(a))}(a)})),this}if(t&&"get-active-node"===t.toLowerCase()){let t=[];return n.each((()=>{const a=e(this).find(".t.text-primary").data("id");void 0!==a&&t.push(d(a))})),1===t.length&&(t=t[0]),t}if(t&&"get-root"===t.toLowerCase()){let t=[];return n.each((()=>{const a=e(this).find(".t").eq(0).data("id");void 0!==a&&t.push(d(a))})),1===t.length&&(t=t[0]),t}if(t&&"set-data"===t.toLowerCase())i.tree_data=l(a.slice()),n.html(s());else if(t&&"set-checked"===t.toLowerCase()){if(void 0===a)return;n.find(".check").each((function(){e(this).attr("data-checked","u")})),n.find(".t").each((function(){let t=e(this),c=t.data("id");a.indexOf(c)>-1&&(t.siblings(".check").attr("data-checked","c"),o(t))}))}else if(t&&"get-checked"===t.toLowerCase()){let t=[];const c=a??!0?'.check:not([data-checked="u"])':'.check[data-checked="c"]';return n.find(c).each((function(){t.push(e(this).siblings(".t").data("id"))})),t}}}(jQuery);